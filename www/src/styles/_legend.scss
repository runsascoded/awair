// Custom legend controls - positioned above Plotly legend
.custom-legend-controls {
  margin: 0 1rem; // Plot left/right margin is 35px; we want to align with the outside of the y-ticks that live in that margin.
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  z-index: 10;

  .legend-metric-control {
    display: flex;
    flex-direction: column;
    align-items: flex-start;

    .legend-controls-row {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .legend-labels-row {
      display: flex;
      align-items: center;
      gap: 0; // No gap - padding extends hover areas to prevent flicker

      > .legend-line-sample {
        display: inline-block;
        width: 1.25rem;
        height: 3px;
        border-radius: 1px;
        margin: 0 0.25rem;
        vertical-align: middle;
      }
    }

    .range-mode-btn {
      user-select: none;

      &.active {
        background: var(--accent-primary);
        border-color: var(--accent-primary);
        color: white;

        &:hover {
          background: var(--accent-secondary);
          border-color: var(--accent-secondary);
        }

        &.preview {
          // Preview active: reduced opacity to distinguish from actual clicked state
          opacity: 0.6;
        }
      }

      &.preview:not(.active) {
        // Preview inactive: reduced opacity to distinguish from actual non-active state
        opacity: 0.6;
      }
    }

    .floor-edit-input {
      width: 4rem;
      padding: 0.15rem 0.25rem;
      font-size: 0.85rem;
      border: 1px solid var(--accent-primary);
      border-radius: 4px;
      background: var(--bg-primary);
      color: var(--text-primary);
      text-align: center;

      &:focus {
        outline: none;
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
      }
    }

    .metric-unit {
      font-size: 0.85rem;
      color: var(--text-primary); // Match y-tick color
      white-space: nowrap;
      cursor: pointer;
    }

    .left-unit {
      padding-right: 0.75rem; // Extend hover area toward legend items
    }

    .right-unit {
      padding-left: 0.75rem; // Extend hover area toward legend items
    }

    .legend-devices {
      display: flex;
      align-items: center;

      .legend-device-item {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        padding: 0 0.375rem;

        &:first-child {
          padding-left: 0;
        }

        &:last-child {
          padding-right: 0;
        }
      }

      .legend-line-sample {
        display: inline-block;
        width: 1.25rem;
        height: 3px;
        border-radius: 1px;
        vertical-align: middle;
        cursor: pointer;
      }

      .legend-device-name {
        font-size: 0.85rem;
        color: var(--text-primary);
        white-space: nowrap;
        cursor: pointer;
      }
    }

    &.legend-metric-left {
      align-items: flex-start;
    }

    &.legend-metric-right {
      align-items: flex-end;

      .legend-labels-row {
        flex-direction: row-reverse;
      }
    }
  }

  // Single device: wider line samples since there's more space
  &.single-device {
    .legend-labels-row > .legend-line-sample {
      width: 3rem;
    }
  }

  // Mobile: keep horizontal but allow wrapping if needed
  @media (max-width: 768px) {
    left: 10px;
    right: 10px;
  }

  // OG mode: larger legend, hide inactive controls
  .og-mode & {
    margin: 0 1rem;  // More horizontal margin to prevent clipping

    .legend-metric-control {
      .legend-controls-row {
        // Hide the â‰¥0 buttons in OG mode (they're inactive anyway)
        .range-mode-btn {
          display: none;
        }

        select {
          font-size: 1.1rem;
          padding: 0.2rem 0.4rem;
          line-height: 1.4;
          height: 2rem;  // Explicit height to fit font + padding
        }
      }

      .legend-labels-row {
        > .legend-line-sample {
          width: 1.75rem;
          height: 4px;
        }
      }

      .metric-unit {
        font-size: 1.1rem;
      }

      .legend-devices {
        .legend-line-sample {
          width: 1.75rem;
          height: 4px;
        }

        .legend-device-name {
          font-size: 1.1rem;
        }
      }
    }
  }
}
